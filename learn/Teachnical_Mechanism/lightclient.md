## Light Client and Maintainer

To validate the cryptographic proof for cross-chain message, a trusted root is required. Normally the cryptographic proof is the existence Merkle proof of a specific value in a (variant) Merkle tree, e.g., the Merkle Patricia Tree (MPT) in Ethereum or Immutable AVL (IAVL+) tree used in Cosmos and the trusted root is the Merkle root of the tree that is usually included in block header. Then by feeding all block headers of all interested blockchains to MAP Relay Chain, the availability problem of trusted root can be easily solved. Yet, with continuous efforts put into shortening the block generation internal, processing all uploaded block headers on MAP Relay Chain would consume considerable resources, especially when we are trying to connect more and more blockchains and blockchains like Binance Smart Chain, Polygon networks are already producing blocks every 2 or 3 seconds. Another problem is that, how to validate the correctness of the uploaded block headers? The design of MAP protocol is to remove all trusted parties, thus relying on trusted parties to upload correct block headers is clearly not an acceptable solution. Following the advancement of SPV technology and light client construction technology, both problems can be solved in a trustless way. The core observation is that almost all blockchains can reach consensus with very limited information.

### Light client of PoW chain

Nakamoto consensus-like chain, e.g.,  Ethereum, new block header can be easily checked following the consensus rules, e.g., the hash link as well as the accumulated work etc. If Ethereum network won’t re-org more than n blocks, then a light client of Ethereum only needs to preserve n+1 newest block headers to verify new block headers and update its internal state in an autonomous way. Considering the latency to relay the crossing-chain message, light clients built this way can store more block headers, e.g., block headers generated in the last 48 hours. With Ethereum’s ~13-second block interval, light client on MAP Relay Chain only needs to store 13k Ethereum block headers. On the other side, by adopting Flyclient technique, the number of blocks uploaded to MAP Relay Chain can be significantly reduced. Although the genesis state of a light client requires manually setup, the trustless feature is not compromised since any one can check the correctness of the genesis state. We conject that this is basically the same as the “weak subjective” concept populated in the Proof-of-Stake world.

### Light client of PoS chain

For Proof-of-Stake and BFT based blockchains, the construction of light client might seem quite difficult at the beginning. Thanks to the work of the Tendermint team, it turns that a more efficient light client can be built. While the technique detail could be quite lengthy, the core idea is simple. In such networks, blocks are signed off by a group of selected staked validators, so by verifying a few digital signatures, the validity of a block can be easily checked. The set of validators could change over time, but in typical PoS networks, new set of validators also needed to be proved by the old set via signatures. In this way, with only a little information of current validator set, e.g., staked weight, public keys of each validator set, a light client can easily check new block headers as well as updating itself. There is even no need to upload all block headers, only a tiny few, e.g., those involved in a cross-chain operation, or validate set upgrade.

Light clients on MAP Relay Chain are initialized as smart contracts, so that the chain can quickly add new light client for new blockchains connected by MAP Relay Chain. Merkle proof verification and digital signature verification are crucial to the construction and operation of light client. But, implementing these cryptography primitives with Solidity is both tricky and inefficient, especially various cryptography primitives are used in different blockchains. To ease the development of light clients, all kinds of cryptography primitives are supported at the blockchain level and are exposed to EVM via pre-compiled contracts.

### Light client of MAP Relay Chain

Solely maintaining light clients of connected blockchains on MAP Relay Chain is not enough for bidirectional cross-chain interoperation in a trustless style, MAP protocol requires the existence of MAP Relay Chain’s light client on each connected blockchain. While on MAP Relay Chain, the gas price can be continuous optimized to stay as low as possible, on other chains, we must accept the reality. As MAP Relay Chain adopts PoS and IBFT, a light client can be easily built following above technique. To optimize the gas consumption of the light client on other chains, MAP Relay Chain adopts aggregate  BLS signature over BN256 curve. In this way, the verification of the signatures of MAP Relay Chain’s validators can be reduced to verify only one aggregated signature with one aggregated public key. As precompile contract of BN256 is widely supported by the EVM-compatible blockchain, the gas consumption of maintaining MAP Relay Chain’s light client can be reduced. 
